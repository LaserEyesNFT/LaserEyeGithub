webpackJsonp([4],{"3v0t":function(e,t){},"5PlU":function(e,t,n){var a=n("RY/4"),i=n("dSzd")("iterator"),r=n("/bQp");e.exports=n("FeBl").isIterable=function(e){var t=Object(e);return void 0!==t[i]||"@@iterator"in t||r.hasOwnProperty(a(t))}},AjLI:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n("W3Iv"),i=n.n(a),r=n("d7EF"),o=n.n(r),s=n("BO1k"),l=n.n(s),c=n("Xxa5"),u=n.n(c),d=n("exGp"),b=n.n(d),m=n("v1w/"),p=(n("U/y8"),n("DHPL")),f=(n("YaEn"),n("ONoB")),h=n("oAV5"),k=n("vaUZ"),v=n.n(k),g=n("geuY"),y=n.n(g),S=Object(m.d)(),_={name:"BulkPayPage",components:{},data:function(){return{bSignedIn:m.g.isUserSignedIn(),selfAddr:m.g.isUserSignedIn()?Object(m.a)():"",maxSendListLen:200,tokenId:"STX",tokenList:[{value:"STX",label:"STX"}],tokenMap:{STX:{symbol:"STX",balance:"-",balanceStr:"-",decimal:6,bDecimalFlag:!0}},sendList:[{receiver:"",amount:"",memo:""}],bulkAddInfo:{bVisible:!1,recInfoStr:"",memo:""},compKey1:0,tips:{invalidTokenContract:"Invalid token contract"}}},mounted:function(){var e=this;return b()(u.a.mark(function t(){return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.bSignedIn&&e.refreshAllBalance();case 1:case"end":return t.stop()}},t,e)}))()},computed:{totalAmount:function(){var e=0,t=!0,n=!1,a=void 0;try{for(var i,r=l()(this.sendList);!(t=(i=r.next()).done);t=!0){var o=i.value;parseFloat(o.amount)&&(e+=this.getAccurateAmount(o.amount,10))}}catch(e){n=!0,a=e}finally{try{!t&&r.return&&r.return()}finally{if(n)throw a}}return e/Math.pow(10,10)},myBalanceStr:function(){return this.compKey1,this.bSignedIn?this.tokenMap[this.tokenId].balanceStr:"-"},exceedBalance:function(){this.compKey1;var e=this.tokenMap[this.tokenId].balanceStr;return"-"!=e&&this.totalAmount>parseFloat(e)}},methods:{onClickRefresh:function(){var e=this;return b()(u.a.mark(function t(){return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.tokenMap[e.tokenId].balanceStr="-",e.$forceUpdate(),t.next=4,e.refreshAllBalance();case 4:case"end":return t.stop()}},t,e)}))()},refreshAllBalance:function(){var e=this;return b()(u.a.mark(function t(){var n,a,r,s,c,d,b,p,f,k,g,y,S;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,v()("https://api.mainnet.hiro.so/extended/v1/address/"+Object(m.a)()+"/balances");case 2:if(200!=(n=t.sent).status){t.next=32;break}return t.next=6,n.json();case 6:for(a=t.sent,e.tokenMap.STX.balance=parseInt(a.stx.balance),e.tokenMap.STX.balanceStr=e.tokenMap.STX.balance/Math.pow(10,e.tokenMap.STX.decimal),r=!0,s=!1,c=void 0,t.prev=12,d=l()(i()(a.fungible_tokens));!(r=(b=d.next()).done);r=!0)p=b.value,f=o()(p,2),k=f[0],g=f[1],y=k.split("::"),S=y[0].split("."),e.tokenMap[k]?(e.tokenMap[k].balance=g.balance,e.tokenMap[k].bDecimalFlag&&(e.tokenMap[k].balanceStr=g.balance/Math.pow(10,e.tokenMap[k].decimal))):(e.tokenList.push({value:k,label:y[1]}),e.tokenMap[k]={contractAddress:S[0],contractName:S[1],url:"https://explorer.stacks.co/address/"+S[0]+"."+S[1]+"?chain=mainnet",symbol:y[1],balance:g.balance,balanceStr:"-",decimal:0,bDecimalFlag:!1});t.next=20;break;case 16:t.prev=16,t.t0=t.catch(12),s=!0,c=t.t0;case 20:t.prev=20,t.prev=21,!r&&d.return&&d.return();case 23:if(t.prev=23,!s){t.next=26;break}throw c;case 26:return t.finish(23);case 27:return t.finish(20);case 28:e.compKey1++,e.$forceUpdate(),t.next=33;break;case 32:Object(h.a)(e,"Request fail, status="+n.status);case 33:case"end":return t.stop()}},t,e,[[12,16,20,28],[21,,23,27]])}))()},onChangeTokenType:function(){var e=this;return b()(u.a.mark(function t(){var n,a,i,r;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("STX"==e.tokenId){t.next=23;break}if("-"!=(n=e.tokenMap[e.tokenId]).balanceStr){t.next=21;break}return a={contractAddress:n.contractAddress,contractName:n.contractName,functionName:"get-decimals",functionArgs:[],network:S,senderAddress:Object(m.a)()},t.prev=4,t.next=7,Object(f.i)(a);case 7:i=t.sent,r=Object(f.m)(i),n.decimal=r.value,n.bDecimalFlag=!0,n.balanceStr=n.balance/Math.pow(10,n.decimal),e.compKey1++,e.$forceUpdate(),t.next=19;break;case 16:t.prev=16,t.t0=t.catch(4),Object(h.a)(e,"Query decimal fail");case 19:t.next=23;break;case 21:e.compKey1++,e.$forceUpdate();case 23:case"end":return t.stop()}},t,e,[[4,16]])}))()},onClickDeleteBulkItem:function(e,t){this.sendList.splice(e,1)},onClickSignIn:function(){Object(m.e)()},onClickAdd:function(){this.sendList.push({receiver:"",amount:"",memo:""})},onClickBulkAdd:function(){this.bulkAddInfo.bVisible=!0,this.bulkAddInfo.recInfoStr=""},onClickRemoveAll:function(){var e=this;this.$confirm("Will remove all items, are you sure?","",{confirmButtonText:"Yes",cancelButtonText:"No"}).then(function(){e.sendList.splice(0,e.sendList.length)})},onCloseDrawer:function(){if(0==this.bulkAddInfo.recInfoStr.trim().length)this.bulkAddInfo.bVisible=!1;else{var e=this;this.$confirm("Will close the bulk add dialog, are you sure?","",{confirmButtonText:"Yes",cancelButtonText:"No"}).then(function(){e.bulkAddInfo.bVisible=!1})}},onClickSureBulkAdd:function(){for(var e=this.sendList.length,t=this.bulkAddInfo.recInfoStr.trim().match(/[^\r\n]+/g),n={},a=null,i=0;i<t.length&&!a;i++){var r=t[i],o=r.split(",");if(2!=o.length){a="Line "+(i+1)+", invalid format ("+r+").";break}try{var s=o[0].split(".");1==s.length?Object(f.C)(s[0]):Object(f.j)(s[0],s[1])}catch(e){a="Line "+(i+1)+", invalid address ("+r+").";break}if(o[0]==Object(m.a)()){a="Line "+(i+1)+", address cannot be self ("+r+").";break}if(n[o[0]]){a="Line "+(i+1)+"'s address equals with line "+n[o[0]]+"'s.";break}var l=parseFloat(o[1]);if(!l||l<0){a="Line "+(i+1)+", invalid amount ("+o[1]+").";break}if(!this.getAccurateAmount(l,this.tokenMap[this.tokenId].decimal)){a="Line "+(i+1)+", invalid amount ("+o[1]+"), decimal is "+this.tokenMap[this.tokenId].decimal+".";break}n[o[0]]=i+1,this.sendList.push({receiver:o[0],amount:l,memo:this.bulkAddInfo.memo})}if(a)return this.sendList.splice(e),void Object(h.a)(this,a);1==e&&""==this.sendList[0].receiver&&""==this.sendList[0].amount&&this.sendList.splice(0,1),this.sendList.length>this.maxSendListLen&&this.sendList.splice(this.maxSendListLen),this.bulkAddInfo.bVisible=!1},onClickPay:function(){var e=!1;if("STX"==this.tokenId)for(var t=0;t<this.sendList.length;t++)this.sendList[t].memo.trim().length>0&&(e=!0);else e=!0;var n=null;n="STX"==this.tokenId?e?"bulk-pay-with-memo":"bulk-pay":"bulk-pay-ft";var a=null,i=Object(f.r)();i.list=[];for(var r={},o=0;o<this.sendList.length;o++){var s=this.sendList[o],l=null,c=s.receiver.trim();try{var u=c.split(".");l=1==u.length?Object(f.C)(u[0]):Object(f.j)(u[0],u[1])}catch(e){a="Line "+(o+1)+", invalid address ("+s.receiver+").";break}if(c==Object(m.a)()){a="Line "+(o+1)+", address cannot be self ("+s.receiver+").";break}if(r[c]){a="Line "+(o+1)+"'s address equals with line "+r[c]+"'s.";break}var d=parseFloat(s.amount);if(!d||d<0){a="Line "+(o+1)+", invalid amount ("+s.amount+").";break}r[c]=o+1;var b={addr:l},p=this.getAccurateAmount(d,this.tokenMap[this.tokenId].decimal);if(!p){a="Line "+(o+1)+", invalid amount ("+s.amount+"), decimal is "+this.tokenMap[this.tokenId].decimal+".";break}try{b.amount=Object(f.H)(p)}catch(e){a="Line "+(o+1)+", invalid amount ("+s.amount+"), too big.";break}e&&(b.memo=s.memo.trim().length>0?Object(f.B)(Object(f.h)(s.memo.trim())):Object(f.y)()),i.list.push(Object(f.G)(b))}if(a)Object(h.a)(this,a);else if("STX"==this.tokenId){var k=this.tokenMap[this.tokenId].balanceStr;if(k<this.totalAmount)return void Object(h.a)(this,"Balance unenough.");if(k==this.totalAmount)return void Object(h.a)(this,"No remain for gas fee.");if(k-this.totalAmount<1){var v=this,g=this.getAccurateAmount(k,6)-this.getAccurateAmount(this.totalAmount,6);this.$confirm("Balance: "+k+" STX, Total pay: "+this.totalAmount+" STX, so make sure gas fee no more than "+g/1e6+" STX.","",{confirmButtonText:"Ok",cancelButtonText:"Cancel"}).then(function(){v.startPay(n,i)})}else this.startPay(n,i)}else{if(this.totalAmount>this.tokenMap[this.tokenId].balanceStr)return void Object(h.a)(this,"Balance unenough.");this.startPay(n,i)}},getAccurateAmount:function(e,t){var n=e.toString();if("1"==n.substring(0,1)){var a=n.indexOf("e-");if(-1!=a){var i=parseInt(n.substring(a+2)),r=n.indexOf("."),o="";o=-1!=r?""+n.substring(0,r)+n.substring(r+1,a):""+n.substring(0,a),n="0."+"0".repeat(i-1)+o}}var s=n.indexOf(".");if(-1!=s){var l=n.length-s-1;n=l<=t?""+n.substring(0,s)+n.substring(s+1)+"0".repeat(t-l):""+n.substring(0,s)+n.substring(s+1,s+1+t)}else n=""+n+"0".repeat(t);return"0"==n.substring(0,1)&&(n=n.substring(1)),n.match(/^0*$/g)?0:parseInt(n)},startPay:function(e,t){var n=[],a=[];if("bulk-pay"==e||"bulk-pay-with-memo"==e){n.push(Object(f.F)()),n.push(t);var i=this.getAccurateAmount(this.totalAmount,6);console.log("____stx_amountIntV",i),a.push(Object(f.x)(Object(m.a)(),f.d.LessEqual,new y.a(i)))}else if("bulk-pay-ft"==e){n.push(Object(f.F)());var r=this.tokenMap[this.tokenId];n.push(Object(f.j)(r.contractAddress,r.contractName)),n.push(t);var o=Object(f.k)(r.contractAddress,r.contractName,r.symbol),s=this.getAccurateAmount(this.totalAmount,r.decimal);console.log("____ft_amountIntV",s),a.push(Object(f.v)(Object(m.a)(),f.d.LessEqual,new y.a(s),o))}var l=this,c={contractAddress:"SPMCWHJY8CJX5WP0PKKYS12FWYC1J2VNXDT42B5R",contractName:e,functionName:"bulk-pay",functionArgs:n,network:S,appDetails:Object(m.b)(),postConditions:a,onFinish:function(e){l.$notify({title:"Pay sent",message:"Transaction has been sent, wait a while to be finished."})}};Object(p.c)(c)},createLoading:function(e,t){return this.$loading({lock:!0,text:e,spinner:"el-icon-loading",background:t||"rgba(0, 0, 0, 0.05)"})},onClickTest1:function(){},onClickTest2:function(){}}},I={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{attrs:{id:"main"}},[n("div",[n("span",[e._v("Token:")]),e._v(" "),n("el-select",{staticClass:"ib",staticStyle:{width:"100px"},attrs:{size:"small"},on:{change:e.onChangeTokenType},model:{value:e.tokenId,callback:function(t){e.tokenId=t},expression:"tokenId"}},e._l(e.tokenList,function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1),e._v(" "),"STX"!=e.tokenId?n("el-link",{staticClass:"ib",staticStyle:{color:"grey"},attrs:{href:e.tokenMap[e.tokenId].url,target:"_blank"}},[e._v(e._s(e.tokenMap[e.tokenId].contractAddress+"."+e.tokenMap[e.tokenId].contractName))]):e._e()],1),e._v(" "),n("el-table",{attrs:{id:"bulkRegTable","empty-text":"Empty",size:"mini",data:e.sendList}},[n("el-table-column",{attrs:{type:"index",width:"46"}}),e._v(" "),n("el-table-column",{attrs:{label:"Receiver",width:"520"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-input",{attrs:{clearable:"",disabled:!e.bSignedIn,placeholder:"receiver",maxlength:"150"},model:{value:t.row.receiver,callback:function(n){e.$set(t.row,"receiver",n)},expression:"scope.row.receiver"}})]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"Amount",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-input",{attrs:{clearable:"",disabled:!e.bSignedIn,placeholder:"amount",maxlength:"50"},model:{value:t.row.amount,callback:function(n){e.$set(t.row,"amount",n)},expression:"scope.row.amount"}})]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"Memo(optional, max 34 characters)",width:"320"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-input",{attrs:{clearable:"",disabled:!e.bSignedIn,placeholder:"memo",maxlength:"34"},model:{value:t.row.memo,callback:function(n){e.$set(t.row,"memo",n)},expression:"scope.row.memo"}})]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"Action"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{disabled:!e.bSignedIn,type:"danger",icon:"el-icon-delete",circle:""},on:{click:function(n){return e.onClickDeleteBulkItem(t.$index,t.row)}}})]}}])})],1),e._v(" "),n("div",{staticStyle:{"margin-left":"55px","margin-top":"12px"}},[e.sendList.length==e.maxSendListLen?n("div",{staticStyle:{"font-weight":"bold","margin-bottom":"8px"}},[e._v("Max 200 items.")]):e._e(),e._v(" "),e.bSignedIn?e._e():n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.onClickSignIn()}}},[e._v("Sign in")]),e._v(" "),n("el-button",{attrs:{disabled:!e.bSignedIn||e.sendList.length>=e.maxSendListLen,type:"primary",plain:""},on:{click:function(t){return e.onClickAdd()}}},[e._v("   Add   ")]),e._v(" "),n("el-button",{attrs:{disabled:!e.bSignedIn,type:"primary",plain:""},on:{click:function(t){return e.onClickBulkAdd()}}},[e._v("Bulk add")]),e._v(" "),n("el-button",{attrs:{disabled:!e.bSignedIn,type:"info",plain:""},on:{click:function(t){return e.onClickRemoveAll()}}},[e._v("Remove all")]),e._v(" "),e.bSignedIn?n("div",{staticStyle:{"margin-top":"32px"}},[n("div",[n("span",{staticStyle:{"min-width":"75px",display:"inline-block"}},[e._v("Total pay:")]),e._v(" "),n("span",{style:{color:e.exceedBalance?"red":"black"}},[e._v(e._s(e.totalAmount)+" ")]),e._v("\n          "+e._s(e.tokenMap[e.tokenId].symbol)+"\n        ")]),e._v(" "),n("div",{staticStyle:{"margin-top":"16px"}},[n("span",{staticStyle:{"min-width":"75px",display:"inline-block"}},[e._v("Balance:")]),e._v(" "),n("span",{directives:[{name:"loading",rawName:"v-loading",value:"-"==e.tokenMap[e.tokenId].balanceStr,expression:"tokenMap[tokenId].balanceStr == '-'"}]},[e._v("\n            "+e._s(e.tokenMap[e.tokenId].balanceStr)+" "+e._s(e.tokenMap[e.tokenId].symbol)+"\n          ")]),e._v(" "),"-"!=e.tokenMap[e.tokenId].balanceStr?n("el-button",{staticStyle:{"margin-left":"4px"},attrs:{type:"primary",plain:"",size:"mini"},on:{click:function(t){return e.onClickRefresh()}}},[e._v("Refresh")]):e._e(),e._v(" "),"-"!=e.myBalanceStr?n("span",{staticStyle:{color:"grey","margin-left":"8px"}},[e._v("\n            (Current account: "+e._s(e.selfAddr)+")\n          ")]):e._e()],1),e._v(" "),n("el-button",{staticStyle:{"margin-top":"12px"},attrs:{disabled:e.totalAmount<=0,type:"primary"},on:{click:function(t){return e.onClickPay()}}},[e._v("   Pay   ")])],1):e._e()],1),e._v(" "),n("el-drawer",{attrs:{title:"Bulk add",visible:e.bulkAddInfo.bVisible,"before-close":e.onCloseDrawer,direction:"ltr",size:"750px"},on:{"update:visible":function(t){return e.$set(e.bulkAddInfo,"bVisible",t)}}},[n("div",{staticStyle:{width:"650px","margin-left":"50px"}},[n("div",{staticClass:"bulkTitle",staticStyle:{color:"grey"}},[e._v("Input "),n("span",{staticStyle:{color:"black"}},[e._v("address,amount")]),e._v(" per line:")]),e._v(" "),n("el-input",{attrs:{type:"textarea",placeholder:"address,amount",rows:"20",clearable:""},model:{value:e.bulkAddInfo.recInfoStr,callback:function(t){e.$set(e.bulkAddInfo,"recInfoStr",t)},expression:"bulkAddInfo.recInfoStr"}}),e._v(" "),n("div",{staticStyle:{"margin-top":"20px"}}),e._v(" "),n("div",{staticClass:"bulkTitle"},[e._v("Memo(optional, max 34 characters):")]),e._v(" "),n("el-input",{attrs:{clearable:"",placeholder:"memo",maxlength:"34"},model:{value:e.bulkAddInfo.memo,callback:function(t){e.$set(e.bulkAddInfo,"memo",t)},expression:"bulkAddInfo.memo"}}),e._v(" "),n("div",{staticClass:"bulkTitle",staticStyle:{color:"grey","font-size":"14px"}},[e._v("(Left memo empty can save gas)")]),e._v(" "),n("el-button",{staticStyle:{"margin-top":"12px"},attrs:{type:"primary",disabled:0==e.bulkAddInfo.recInfoStr.trim().length},on:{click:function(t){return e.onClickSureBulkAdd()}}},[e._v("   Add   ")])],1)])],1)])},staticRenderFns:[]};var x=n("VU/8")(_,I,!1,function(e){n("3v0t")},"data-v-18491092",null);t.default=x.exports},W3Iv:function(e,t,n){e.exports={default:n("wEtr"),__esModule:!0}},Xd32:function(e,t,n){n("+tPU"),n("zQR9"),e.exports=n("5PlU")},d7EF:function(e,t,n){"use strict";t.__esModule=!0;var a=r(n("us/S")),i=r(n("BO1k"));function r(e){return e&&e.__esModule?e:{default:e}}t.default=function(){return function(e,t){if(Array.isArray(e))return e;if((0,a.default)(Object(e)))return function(e,t){var n=[],a=!0,r=!1,o=void 0;try{for(var s,l=(0,i.default)(e);!(a=(s=l.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(r)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()},gSvA:function(e,t,n){var a=n("kM2E"),i=n("mbce")(!0);a(a.S,"Object",{entries:function(e){return i(e)}})},mbce:function(e,t,n){var a=n("+E39"),i=n("lktj"),r=n("TcQ7"),o=n("NpIQ").f;e.exports=function(e){return function(t){for(var n,s=r(t),l=i(s),c=l.length,u=0,d=[];c>u;)n=l[u++],a&&!o.call(s,n)||d.push(e?[n,s[n]]:s[n]);return d}}},"us/S":function(e,t,n){e.exports={default:n("Xd32"),__esModule:!0}},wEtr:function(e,t,n){n("gSvA"),e.exports=n("FeBl").Object.entries}});