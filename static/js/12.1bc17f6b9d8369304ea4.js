webpackJsonp([12],{EwrY:function(t,e){},gAs1:function(t,e){e.endianness=function(){return"LE"},e.hostname=function(){return"undefined"!=typeof location?location.hostname:""},e.loadavg=function(){return[]},e.uptime=function(){return 0},e.freemem=function(){return Number.MAX_VALUE},e.totalmem=function(){return Number.MAX_VALUE},e.cpus=function(){return[]},e.type=function(){return"Browser"},e.release=function(){return"undefined"!=typeof navigator?navigator.appVersion:""},e.networkInterfaces=e.getNetworkInterfaces=function(){return{}},e.arch=function(){return"javascript"},e.platform=function(){return"browser"},e.tmpdir=e.tmpDir=function(){return"/tmp"},e.EOL="\n",e.homedir=function(){return"/"}},oGIJ:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n("BO1k"),a=n.n(i),r=n("Xxa5"),s=n.n(r),o=n("exGp"),c=n.n(o),l=n("v1w/"),u=n("oAV5"),d=n("ONoB"),h=n("DHPL"),b=(n("YaEn"),n("gAs1"),n("geuY")),p=n.n(b),v=Object(l.c)(),m=v.contractAddress,f=(v.contractName,v.marketContractName,v.chatroomContractName,v.likeContractName,v.BNSContractAddress,v.BNSContractName,v.ordiTokenName),g=v.lotteryContractName2,k=m,_=Object(l.d)(),x={name:"BetPage",components:{},data:function(){return{bSignedIn:l.g.isUserSignedIn(),subMenu:"",config:{ordiPrice:1e8,minBetCountToStartRound:5,maxBetPerRound:3e4,betBlocks:124,waitToEndBetBlocks:6,waitToDrawBlocks:14},bInitialReq:!1,round:0,state:1,stateStr:"",bCanEndBet:!1,bCanDraw:!1,totalBetCount:0,curStxHeight:0,startAtStxHeight:0,endAtStxHeight:0,endAtBtcHeight:0,tid:0,stxBalance:0,ordiBalance:0,timeHandle:null,maxOrderListHeight:520,hexList:["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],marginGap:"auto 40px",pendingChs:"",bInstantPickVisible:!1,instantPickCount:200,instantPickStep:0,instantPickMaxCount:0,bExpandOrderList:!1,maxOrderCount:200,orderList:[],bInputBtcHeightVisible:!1,latestBtcHeight:"",bJustBet:!1,historyBetList:[],bSendEndBet:!1,bSendDraw:!1}},mounted:function(){var t=this;return c()(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.bInitialReq=!0,e.next=3,t.requestSummary();case 3:t.bInitialReq=!1;case 4:case"end":return e.stop()}},e,t)}))()},methods:{alreadyBet:function(){return this.bJustBet||this.historyBetList.length>0},requestSummary:function(){var t=this;return c()(s.a.mark(function e(){var n,i,r,o,c,u,h,b,p,v,f,x;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.bSignedIn?"get_summary_with_user":"get_summary",i=t.bSignedIn?[Object(d.C)(Object(l.a)())]:[],r={contractAddress:m,contractName:g,functionName:n,functionArgs:i,network:_,senderAddress:k},e.next=5,Object(d.i)(r);case 5:if(o=e.sent,c=Object(d.m)(o),u=t.bSignedIn?c.base.value:c,t.round=u.round.value,t.state=u.state.value,t.totalBetCount=u.bet_count.value,t.curStxHeight=u.bh.value,t.startAtStxHeight=u.start_at.value,t.endAtStxHeight=u.end_at.value,t.endAtBtcHeight=u.end_at_btc.value,!t.bSignedIn){e.next=40;break}if(t.stxBalance=c.stx.value,t.ordiBalance=c.ordi.value,c.tid.type.includes("none")?t.tid=0:t.tid=c.tid.value.value,c.user_bet.type.includes("none")){e.next=40;break}for(t.historyBetList.splice(0,t.historyBetList.length),h=!0,b=!1,p=void 0,e.prev=24,v=a()(c.user_bet.value.value);!(h=(f=v.next()).done);h=!0)x=f.value,t.historyBetList.push({chs:x.value});e.next=32;break;case 28:e.prev=28,e.t0=e.catch(24),b=!0,p=e.t0;case 32:e.prev=32,e.prev=33,!h&&v.return&&v.return();case 35:if(e.prev=35,!b){e.next=38;break}throw p;case 38:return e.finish(35);case 39:return e.finish(32);case 40:t.dealDrawState(),t.timeHandle&&clearInterval(t.timeHandle),t.timeHandle=setTimeout(t.requestSummary,2e4);case 43:case"end":return e.stop()}},e,t,[[24,28,32,40],[33,,35,39]])}))()},dealDrawState:function(){if(this.bCanEndBet=!1,this.bCanDraw=!1,1==this.state)this.stateStr="Make at least "+this.config.minBetCountToStartRound+" bets to start the round",this.marginGap="auto 27px";else if(2==this.state){var t=this.startAtStxHeight+this.config.betBlocks-this.curStxHeight;if(t>0)this.stateStr="Bet available (remain "+t+" blocks)",this.marginGap="auto 20px";else{var e=this.startAtStxHeight+this.config.betBlocks+this.config.waitToEndBetBlocks-this.curStxHeight;e>0?(this.stateStr="Wait to end bet (remain "+e+" blocks)",this.marginGap="auto 20px"):(this.bCanEndBet=!0,this.marginGap="auto 30px")}}else if(3==this.state){var n=this.endAtStxHeight+this.config.waitToDrawBlocks-this.curStxHeight;n>0?(this.stateStr="Wait to draw (remain "+n+" blocks)",this.marginGap="auto 20px"):(this.stateStr="Draw available",this.marginGap="auto 38px",this.bCanDraw=!0)}else this.stateStr="Freezed",this.marginGap="auto 66px"},onClickInstantPick:function(){this.bSignedIn?this.orderList.length>=this.maxOrderCount?Object(u.j)(this,"Max "+this.maxOrderCount+" bets per round"):(this.instantPickMaxCount=Math.max(0,this.maxOrderCount-this.orderList.length),this.instantPickMaxCount>0&&this.instantPickMaxCount<10?(this.instantPickStep=1,this.instantPickCount=1):(this.instantPickStep=10,this.instantPickCount=10),this.bInstantPickVisible=!0):Object(l.e)()},chsCmp:function(t,e){return t.chs!=e.chs?t.chs<e.chs?-1:1:0},onClickCharacter:function(t,e){if(this.bSignedIn){if(!(this.pendingChs.length>=5)){var n=this.hexList[e-1];this.pendingChs=this.pendingChs+n,5==this.pendingChs.length&&(this.orderList.length<this.maxOrderCount?(this.orderList.unshift({chs:this.pendingChs}),this.pendingChs="",this.checkDuplicateBets()):Object(u.j)(this,"Max "+this.maxOrderCount+" bets per round"))}}else Object(l.e)()},onClickPickPendingBackBtn:function(){this.pendingChs.length>0&&(this.pendingChs=this.pendingChs.substring(0,this.pendingChs.length-1))},handleInstantPick:function(){var t;this.bInstantPickVisible=!1;var e=Math.min(this.instantPickCount,this.maxOrderCount-this.orderList.length);if(!(e<=0)){this.pendingChs="";var n={},i=!0,r=!1,s=void 0;try{for(var o,c=a()(this.orderList);!(i=(o=c.next()).done);i=!0){n[o.value.chs]=!0}}catch(t){r=!0,s=t}finally{try{!i&&c.return&&c.return()}finally{if(r)throw s}}for(var l=[],u=0;u<e;u++){var d=this.genRandom(n);d&&5==d.length&&(l.push({chs:d,bDup:!1}),n[d]=!0)}(t=this.orderList).unshift.apply(t,l),this.checkDuplicateBets()}},genRandom:function(t){for(var e=0;e<1e6;e++){var n=Math.floor(16*Math.random()),i=Math.floor(16*Math.random()),a=Math.floor(16*Math.random()),r=Math.floor(16*Math.random()),s=Math.floor(16*Math.random()),o=this.hexList[n]+this.hexList[i]+this.hexList[a]+this.hexList[r]+this.hexList[s];if(!(o in t))return o}},checkDuplicateBets:function(){var t={},e=!0,n=!1,i=void 0;try{for(var r,s=a()(this.orderList);!(e=(r=s.next()).done);e=!0){var o=r.value;o.chs in t?(o.bDup=!0,t[o.chs].bDup=!0):(t[o.chs]=o,o.bDup=!1)}}catch(t){n=!0,i=t}finally{try{!e&&s.return&&s.return()}finally{if(n)throw i}}},handleDelete:function(t,e){this.orderList.splice(t,1),this.checkDuplicateBets()},onClickBet:function(){var t=this;return c()(s.a.mark(function e(){var n,i,r,o,c,b,v,k,x,C,y,B,w,S,O,L,I,P,j;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.bSignedIn){e.next=3;break}return Object(l.e)(),e.abrupt("return");case 3:if(!(t.orderList.length<=0)){e.next=5;break}return e.abrupt("return");case 5:if(!(1==t.state&&t.orderList.length<t.config.minBetCountToStartRound)){e.next=8;break}return Object(u.j)(t,"Need at least 5 bets to start the round"),e.abrupt("return");case 8:if(!(t.totalBetCount>=t.maxBetPerRound)){e.next=11;break}return Object(u.j)(t,"Each round allows at most 30,000 bets"),e.abrupt("return");case 11:if(!(t.totalBetCount+t.orderList.length>t.maxBetPerRound)){e.next=14;break}return Object(u.j)(t,"Each round allows at most 30,000 bets, you can only make "+(t.maxBetPerRound-t.totalBetCount)+" bets"),e.abrupt("return");case 14:if(2!=t.state){e.next=19;break}if(!(t.startAtStxHeight+t.config.betBlocks-t.curStxHeight<0)){e.next=19;break}return Object(u.j)(t,"Cannot bet any more"),e.abrupt("return");case 19:n=!0,i=!1,r=void 0,e.prev=22,o=a()(t.orderList);case 24:if(n=(c=o.next()).done){e.next=32;break}if(!c.value.bDup){e.next=29;break}return Object(u.j)(t,"Have duplicate bets"),e.abrupt("return");case 29:n=!0,e.next=24;break;case 32:e.next=38;break;case 34:e.prev=34,e.t0=e.catch(22),i=!0,r=e.t0;case 38:e.prev=38,e.prev=39,!n&&o.return&&o.return();case 41:if(e.prev=41,!i){e.next=44;break}throw r;case 44:return e.finish(41);case 45:return e.finish(38);case 46:return b=t.createLoading("checking"),e.next=49,t.requestSummary();case 49:if(b.close(),!(t.historyBetList.length>0)){e.next=52;break}return e.abrupt("return");case 52:if(v=t.orderList.length*t.config.ordiPrice,!(t.ordiBalance<v)){e.next=56;break}return Object(u.j)(t,"$ORDI balance unenough"),e.abrupt("return");case 56:for((k=Object(d.r)()).list=[],x=!0,C=!1,y=void 0,e.prev=61,B=a()(t.orderList);!(x=(w=B.next()).done);x=!0)S=w.value,k.list.push(Object(d.D)(S.chs));e.next=69;break;case 65:e.prev=65,e.t1=e.catch(61),C=!0,y=e.t1;case 69:e.prev=69,e.prev=70,!x&&B.return&&B.return();case 72:if(e.prev=72,!C){e.next=75;break}throw y;case 75:return e.finish(72);case 76:return e.finish(69);case 77:O=[k],L=Object(d.k)(m,f,"ORDI"),I=Object(d.v)(Object(l.a)(),d.d.LessEqual,new p.a(v),L),P=t,j={contractAddress:m,contractName:g,functionName:"bet",functionArgs:O,network:_,appDetails:Object(l.b)(),postConditions:[I],onFinish:function(t){P.bJustBet=!0,P.$alert("Transaction has been sent! Each address can only bet once per round, don't bet again in this round. Good luck!",{confirmButtonText:"Ok",type:"info"})}},Object(h.c)(j);case 83:case"end":return e.stop()}},e,t,[[22,34,38,46],[39,,41,45],[61,65,69,77],[70,,72,76]])}))()},onClickEndBet:function(){this.bSignedIn?this.bInputBtcHeightVisible=!0:Object(l.e)()},onSelectBtcHeightOk:function(){var t=parseInt(this.latestBtcHeight);if(!t||t<=791e3)Object(u.j)(this,"Invalid bitcoin block height");else{this.bInputBtcHeightVisible=!1;var e=this,n={contractAddress:m,contractName:g,functionName:"end_bet",functionArgs:[Object(d.H)(t)],network:_,appDetails:Object(l.b)(),postConditions:[],onFinish:function(t){e.bSendEndBet=!0,e.doNotify("End bet")}};Object(h.c)(n)}},onClickDraw:function(){if(this.bSignedIn){var t=this,e={contractAddress:m,contractName:g,functionName:"draw",functionArgs:[],network:_,appDetails:Object(l.b)(),postConditions:[],onFinish:function(e){t.bSendDraw=!0,t.doNotify("Draw")}};Object(h.c)(e)}else Object(l.e)()},createLoading:function(t){return this.$loading({lock:!0,text:t,spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.05)"})},doNotify:function(t){this.$notify({title:t,message:"Transaction has been sent, wait a while to be finished.",duration:8e3})}}},C={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{attrs:{id:"main"}},[n("div",{attrs:{id:"summaryArea"}},[n("div",{attrs:{id:"summaryDiv"}},[n("span",{staticClass:"summaryTitle"},[t._v("Round: ")]),t._v(" "),n("span",[t._v(t._s(0==t.round?"":t.round))]),t._v(" "),n("span",{style:{margin:t.marginGap}},[t._v(" ")]),t._v(" "),n("span",{staticClass:"summaryTitle"},[t._v("State: ")]),t._v(" "),t.bCanEndBet?n("el-button",{staticClass:"summaryBtn",attrs:{disabled:t.bSendEndBet,size:"small",plain:"",type:"primary"},on:{click:t.onClickEndBet}},[t._v("End bet")]):t._e(),t._v(" "),t.bCanDraw?n("el-button",{staticClass:"summaryBtn",attrs:{disabled:t.bSendDraw,size:"small",plain:"",type:"primary"},on:{click:t.onClickDraw}},[t._v("Draw")]):t._e(),t._v(" "),t.bCanDraw||t.bCanEndBet?t._e():n("span",{attrs:{id:"summaryRound"}},[t._v(t._s(t.stateStr))]),t._v(" "),n("span",{style:{margin:t.marginGap}},[t._v(" ")]),t._v(" "),n("span",{staticClass:"summaryTitle"},[t._v("Total bets: ")]),t._v(" "),n("span",[t._v(t._s(0==t.round?"":t.totalBetCount))])],1)]),t._v(" "),0==t.round?n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.bInitialReq,expression:"bInitialReq"}],attrs:{id:"reqLoading"}}):t._e(),t._v(" "),t.bSignedIn&&t.round>0&&0==t.tid?n("div",{attrs:{id:"memberTip"}},[t._v("Sorry, only member can play. Mint to be member "),n("a",{attrs:{href:"https://xnft.fan/#/mine",target:"_blank"}},[t._v("here")]),t._v(".")]):t._e(),t._v(" "),t.round>0?n("div",{attrs:{id:"horArea"}},[n("el-card",{staticClass:"pickArea"},[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[n("span",[t._v("Select 5 characters")]),t._v(" "),n("el-button",{attrs:{id:"instantBtn",size:"small",plain:"",type:"primary",disabled:t.bSignedIn&&0==t.tid||t.state<=0||t.state>2||t.bCanEndBet||t.alreadyBet()||t.orderList.length>=t.maxOrderCount},on:{click:t.onClickInstantPick}},[t._v("Bulk bet")])],1),t._v(" "),n("div",t._l(t.hexList.length,function(e){return n("el-button",{key:e,staticClass:"hexBtn",attrs:{type:"primary",disabled:t.bSignedIn&&0==t.tid||t.alreadyBet()||t.orderList.length>=t.maxOrderCount},on:{click:function(n){return t.onClickCharacter(n,e)}}},[t._v(t._s(t.hexList[e-1]))])}),1),t._v(" "),n("div",{attrs:{id:"pickPendingArea"}},[n("span",{staticClass:"equalWidth"},[t._v(t._s(t.pendingChs))]),t._v(" "),t.pendingChs.length>0?n("el-button",{attrs:{id:"pendingBackBtn",size:"mini",icon:"el-icon-back",circle:""},on:{click:t.onClickPickPendingBackBtn}}):t._e(),t._v(" "),!t.alreadyBet()&&t.orderList.length>=t.maxOrderCount?n("span",{staticClass:"cannotPickTip"},[t._v("Max "+t._s(t.maxOrderCount)+" bets per round.")]):t._e(),t._v(" "),t.alreadyBet()?n("span",{staticClass:"cannotPickTip"},[t._v("Already bet in current round.")]):t._e()],1)]),t._v(" "),t._m(0),t._v(" "),n("el-card",{attrs:{id:"orderArea"}},[n("div",{attrs:{slot:"header"},slot:"header"},[n("span",[t._v("Count: "+t._s(t.orderList.length))]),t._v(" "),n("el-button",{staticClass:"betbtn",style:{visibility:t.orderList.length>0?"visible":"hidden"},attrs:{plain:"",type:"primary",size:"small",disabled:0==t.tid||1!=t.state&&2!=t.state||t.historyBetList.length>0},on:{click:function(e){return t.onClickBet()}}},[t._v("\n            Bet ("+t._s(t.orderList.length*t.config.ordiPrice/1e8+" $ORDI")+")\n          ")])],1),t._v(" "),n("el-table",{attrs:{data:t.orderList,"empty-text":"Empty","max-height":t.maxOrderListHeight,size:"small"}},[n("el-table-column",{attrs:{type:"index",width:"45"}}),t._v(" "),n("el-table-column",{attrs:{label:"Sequence",sortable:"","sort-method":t.chsCmp,width:"190"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("span",{staticClass:"orderChs equalWidth",style:{color:e.row.bDup?"#f00":"#000"}},[t._v(t._s(e.row.chs+(e.row.bDup?"(dupl)":"")))])]}}],null,!1,1239249461)}),t._v(" "),n("el-table-column",{attrs:{label:"Delete"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-button",{attrs:{size:"mini",type:"info",icon:"el-icon-delete",circle:""},on:{click:function(n){return t.handleDelete(e.$index,e.row)}}})]}}],null,!1,3915233267)})],1)],1),t._v(" "),t.historyBetList.length>0?n("el-card",{attrs:{id:"historyArea"}},[n("div",{attrs:{slot:"header"},slot:"header"},[n("span",[t._v("My bets: "+t._s(t.historyBetList.length))]),t._v(" "),n("el-button",{staticClass:"betbtn",style:{visibility:"hidden"},attrs:{plain:"",type:"primary",size:"small"}},[t._v("\n             \n          ")])],1),t._v(" "),n("el-table",{attrs:{data:t.historyBetList,"empty-text":"Empty","max-height":t.maxOrderListHeight,"show-header":!1,size:"small"}},[n("el-table-column",{attrs:{type:"index",width:"45"}}),t._v(" "),n("el-table-column",{attrs:{label:""},scopedSlots:t._u([{key:"default",fn:function(e){return[n("span",{staticClass:"orderChs equalWidth"},[t._v(t._s(e.row.chs))])]}}],null,!1,928455012)})],1)],1):t._e()],1):t._e()]),t._v(" "),t.round>0?n("div",{attrs:{id:"belowTip"}},[t._v("\n    Claim $ORDI "),n("a",{staticClass:"mylink",attrs:{href:"https://xnft.fan/#/x/ordi",target:"_blank"}},[t._v("here")]),t._v(".\n    Mint to be member "),n("a",{staticClass:"mylink",attrs:{href:"https://xnft.fan/#/mine",target:"_blank"}},[t._v("here.")])]):t._e(),t._v(" "),n("el-dialog",{attrs:{title:"How many bets to add?",visible:t.bInstantPickVisible,width:"400px"},on:{"update:visible":function(e){t.bInstantPickVisible=e}}},[n("div",[n("el-input-number",{attrs:{step:t.instantPickStep,min:0,max:t.instantPickMaxCount},model:{value:t.instantPickCount,callback:function(e){t.instantPickCount=e},expression:"instantPickCount"}}),t._v(" "),n("span",{attrs:{id:"bulkAddPrice"}},[t._v("("+t._s(t.instantPickCount*t.config.ordiPrice/1e8+" $ORDI")+")")]),t._v(" "),n("div",{attrs:{id:"bulkAddTip"}},[t._v("* Won't generate duplicate bets.")])],1),t._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(e){t.bInstantPickVisible=!1}}},[t._v("Cancel")]),t._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:t.handleInstantPick}},[t._v("Pick")])],1)]),t._v(" "),n("el-dialog",{attrs:{title:"End bet",visible:t.bInputBtcHeightVisible,width:"400px"},on:{"update:visible":function(e){t.bInputBtcHeightVisible=e}}},[n("div",[n("div",{staticStyle:{"margin-bottom":"8px"}},[t._v("Input latest bitcoin block height:")]),t._v(" "),n("el-input",{attrs:{placeholder:"Latest block height",maxlength:"8",size:"large",clearable:""},model:{value:t.latestBtcHeight,callback:function(e){t.latestBtcHeight=e},expression:"latestBtcHeight"}}),t._v(" "),n("div",{attrs:{id:"btcHeightTip"}},[t._v("\n        View latest block height\n        "),n("a",{staticClass:"mylink",attrs:{href:"https://mempool.space/blocks",target:"_blank"}},[t._v("here")]),t._v("\n        or\n        "),n("a",{staticClass:"mylink",attrs:{href:"https://blockstream.info/blocks/recent",target:"_blank"}},[t._v("here")]),t._v("\n        , wrong number will lead to transaction fail.\n      ")])],1),t._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(e){t.bInputBtcHeightVisible=!1}}},[t._v("Cancel")]),t._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.onSelectBtcHeightOk()}}},[t._v("Ok")])],1)])],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"betArrowArea"},[e("i",{staticClass:"el-icon-d-arrow-right"})])}]};var y=n("VU/8")(x,C,!1,function(t){n("EwrY")},"data-v-6fe33a3a",null);e.default=y.exports}});